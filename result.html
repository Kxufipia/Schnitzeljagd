<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSB Schnitzeljagd 2.0 - Abschluss</title>
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <div class="background-effects">
        <canvas id="campfire"></canvas>
    </div>

    <div id="theme-controls" class="glass-panel"
        style="position: fixed; top: 1rem; right: 1rem; z-index: 50; padding: 0.5rem 1rem; border-radius: 2rem; font-size: 0.9rem; display:flex; gap: 0.5rem; color: #ccc;">
        <a href="leaderboard.html"
            style="text-decoration: none; color: inherit; border-bottom: 1px dashed currentColor; margin-right: 0.5rem;">Bestenliste</a>
        <span id="btn-dark" style="cursor: pointer;">Dark</span> / <span id="btn-light"
            style="cursor: pointer;">Light</span>
    </div>

    <!-- Header Removed for Starry Sky -->

    <main>
        <div class="container animate-enter">
            <div class="hero-text">
                <h1>Quest Abgeschlossen!</h1>
                <p>Du hast das Ende der Reise erreicht.</p>
            </div>

            <div class="glass-panel card">
                <p style="text-align: center; color: var(--text-muted); margin-bottom: 1rem;">
                    Deine Heldentaten wurden aufgezeichnet. Kopiere den folgenden Code und sende ihn an den Questgeber.
                </p>

                <div class="result-box">
                    <button class="btn-secondary copy-btn"
                        style="position: absolute; top: -1.5rem; right: 1rem; padding: 0.5rem 1rem; font-size: 0.8rem;"
                        onclick="copyCode()">Kopieren</button>
                    <span id="result-code">Lade...</span>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                    <!-- Primary Action: Check Scores -->
                    <a href="leaderboard.html" class="btn-primary" style="text-decoration:none; text-align:center;">
                        Zur Bestenliste
                    </a>
                    <!-- Secondary: Restart -->
                    <a href="index.html" class="btn-secondary" style="text-decoration:none; padding: 1rem 2rem;">
                        Neuer Held
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- Static HUD Skeleton -->
    <div id="game-hud" class="glass-panel"
        style="z-index: 9999; view-transition-name: persistent-hud; transition: none;">
        <div class="hud-row header">
            <span class="hud-label">Held</span>
            <span class="hud-value name">...</span>
        </div>
        <div class="hud-divider"></div>
        <div style="margin-top: 1rem; display: flex; justify-content: space-between; align-items: baseline;">
            <span class="hud-accent" style="font-size: 0.9rem; font-weight: bold; text-transform: uppercase;">Stufe
                ...</span>
            <span class="hud-subtext" style="font-size: 0.75rem;">...%</span>
        </div>
        <div class="xp-container" style="margin-top: 0.25rem; margin-bottom: 0.25rem;">
            <div class="xp-bar">
                <div class="xp-fill" style="width: 0%"></div>
                <div class="xp-text">...</div>
            </div>
        </div>
        <div style="text-align: right; margin-bottom: 1rem;">
            <span class="hud-muted" style="font-size: 0.8rem;">Total: ...</span>
        </div>
        <div class="hud-divider"></div>
        <div class="hud-stats-grid">
            <div class="stat-item completed"><span class="stat-label">Erledigt</span><span class="stat-val">...</span>
            </div>
            <div class="stat-item skipped"><span class="stat-label">Skipped</span><span class="stat-val">...</span>
            </div>
            <div class="stat-item open"><span class="stat-label">Offen</span><span class="stat-val">...</span></div>
        </div>
    </div>

    <script src="campfire.js"></script>
    <script src="gamestate.js"></script>
    <script src="sounds.js"></script>
    <script src="toast.js"></script>
    <script src="gamehud.js"></script>
    <script src="script.js"></script>
    <script>
        // Init
        try {
            const currentState = GameState.decode();
            if (!currentState) throw new Error("No state found");

            // document.getElementById('user-display').textContent = currentState.player;

            // The encoding is technically already in the URL ?data=...
            // But let's re-encode just to be sure we display exactly what we have
            const code = GameState.encode(currentState);
            document.getElementById('result-code').textContent = code;

        } catch (e) {
            console.error(e);
            document.getElementById('result-code').textContent = "Fehler: Kein Ergebnis gefunden.";
        }

        function copyCode() {
            const code = document.getElementById('result-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = "Kopiert!";
                setTimeout(() => btn.textContent = "Kopieren", 2000);
            });
        }
    </script>
</body>

</html>